{% extends '../snpage.html' %}
{% set dataPage="profile" %}

{%
set navbarOpts = {
	pageDetailLabel: pUser.name,
	pageId: 'user-profile',
	pageRoot: 'profile',
	navMenu: [{ name: pUser.name, url: pUser.path, icon: 'icon-child' }],
}
%}

{%
set sbOpts = {
	pageRoot: 'profile',
	profile: pUser,
}
%}

{% block title %}
	{{ pUser.name.split(' ')[0] }} | QI Labs
{% endblock %}

{% block head %}
	{% parent %}
	<script>
		conf={postsRoot:'/api/users/{{ pUser.id }}/posts'};
		user_profile={id:'{{pUser.id}}', name:'{{pUser.name}}', path:'{{pUser.path}}', avatarUrl: '{{pUser.avatarUrl}}',username:'{{pUser.username}}'}; posts='';
	</script>
{% endblock %}

{% block global-container %}
	<header class="qi-header" id="globalHeader">
		<canvas class="blur" src="{{ pUser.profile.bgUrl }}"></canvas>
		<div class="elBlackout"></div>

		<div class="profileWrapper">
			{% if pUser.id == user.id %}
				<button data-action="edit-profile" data-toggle="tooltip" data-trigger="hover" data-placement="left" title="Editar perfil">
					<i class="icon-lock"></i>
				</button>
				<button data-action="save-profile" data-toggle="tooltip" data-placement="left" title="Salvar mudanÃ§as">
					<i class="icon-unlock"></i>
				</button>
			{% endif %}

			<div class="user-avatar">
				<div class="avatar" style="background: url({{ pUser.avatarUrl }})"></div>
			</div>

			<section class="usernameWrapper">
				<div class="name profileOutput">{{ pUser.name }}</div>
				{% if pUser.id == user.id %}
					<input class="profileInput" type="text" name="name1" value="{{ pUser.name|split(' ')|index(0) }}" />
					<input class="profileInput" type="text" name="name2" value="{{ pUser.name|split(' ')|index(1) }}" />
				{% endif %}
				{% if pUser.id != user.id %}
					<div style="display: inline-block; width: 0">
						{% if follows %}
							<button class="btn-follow" data-action="unfollow" data-user="{{ pUser.id }}"></button>
						{% else %}
							<button class="btn-follow" data-action="follow" data-user="{{ pUser.id }}"></button>
						{% endif %}
					</div>
				{% endif %}
			</section>
			<section class="bio profileOutput">
				{{ pUser.profile.bio }}
			</section>
			{% if pUser.id == user.id %}
				<textarea class="bio profileInput autosize" name="bio" maxlength="300">{{ pUser.profile.bio }}</textarea>
			{% endif %}

			<section class="whereabout">
				{% if pUser.profile.isStaff %}<i class="icon-check staffCheck" data-toggle="tooltip" title="Staff QI Labs"></i>{% else %}<i class="icon-map-marker"></i>{% endif %}<span class="location profileOutput">{{ pUser.profile.location }}</span><input type="text" class="profileInput" maxlength="50" name="location" value="{{ pUser.profile.location }}"  placeholder="Local de estudo/trabalho"/>&nbsp;<i class="icon-circle"></i>&nbsp;<i class="icon-home"></i><span class="home profileOutput">{{ pUser.profile.home }}</span><input type="text" class="profileInput" maxlength="50" name="home" value="{{ pUser.profile.home }}" placeholder="Cidade de origem" />
			</section>

			<div class="stats">
				<div>
					<a href="{{ pUser.path }}/followers" data-trigger="component" data-component="followers" data-args='{"id":"{{pUser.id}}"}'>
					<h3>{{ pUser.stats.followers }}</h3>
					seguidores
					</a>
				</div>
				<div>
					<a href="{{ pUser.path }}/following" data-trigger="component" data-component="following" data-args='{"id":"{{pUser.id}}"}'>
					<h3>{{ pUser.stats.following }}</h3>
					seguindo
					</a>
				</div>
				{#
				<div>
					<h3>{{ pUser.stats.posts }}</h3>
					posts
				</div>
				#}
				<div>
					<h3>{{ pUser.stats.karma }}</h3>
					QIs
				</div>
			</div>
		</div>
	</header>
	</nav>

	<div id="qi-stream-wrap" class="wall"></div>
{% endblock %}