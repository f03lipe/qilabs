{% extends '../page.html' %}
{%
set page = {
	title: guideNode.name,
	tag: 'guide',
	root: 'guides',
}
%}

{% import '../lib/metaSnippet.html' as metaSnippet %}

{% block meta %}
	{% set smallHtml = guideNode.html.slice(0,500) %}
	{{ metaSnippet.makeMetas({
		title: "Guia "+guide.name+" · QI Labs",
		path: 'http://qilabs.org'+guide.path,
		description: smallHtml.replace(RegExp('(<([^>]+)>)','ig'),""),
		image: "http://qilabs.org/static/images/logoBB.png",
	}) }}
{% endblock %}

{% block head %}
	{% parent %}
	<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i'>
	<script>document.documentElement.className += " unfixed"</script>
{% endblock %}

{% block container %}

<div class="guide-wrapper">

	<div class="sidebar">
		<header>
			<canvas class="blur" src="{{ groot.lab.background }}"></canvas>
			<div class="blackout"></div>
			<div class="info">
				<h1>
					<a href="{{ groot.path }}">
					<small>Guia</small>
					{{ groot.name }}</a>
				</h1>
				<p>
					{{ groot.bio }}
				</p>
				<div class="info-authors">
					{% if groot.contributors.length %}
					<label>Últimas Edições</label>
					{% for person in groot.contributors|slice(5) %}
						<a href="{{ person.path }}">
							<div class="user-avatar">
								<div class="avatar" style="background-image: url('{{ person.avatar_url }}')" data-toggle="tooltip" data-placement="bottom" data-container="body" title="{{ person.name }}"></div>
							</div>
						</a>
					{% endfor %}
					{% endif %}
				</div>
			</div>
		</header>

		{#
		<div class="topicsList">
		{% for g in guideData %}
			<li class="
			{% if g.hasChildren %}
				hasChildren
			{% endif %}
			{% if g.isOpen %}
				open parent
			{% endif %}
			{% if guideNode.id === g.id %}
				active open
			{% endif %}
			"
			{% if !g.path %}
			onClick="toggleArrow(this)"
			{% endif %}
			>
			<a
			{% if g.path %}
			href="{{ g.path }}"
			{% endif %}
			>{{ g.name }}</a>
				{% if g.isOpen %}
					<i class="arrow" onClick="toggleArrow(this.parentElement)"></i>
				{% else %}
					{% if g.hasChildren %}
						<i class="arrow" onClick="toggleArrow(this.parentElement)"></i>
					{% endif %}
				{% endif %}
			</li>
			{% if g.children %}
				<ul>
				{% for g2 in g.children %}
					<li {% if guideNode.id === g2.id %} class="active" {% endif %}>
						<a href="{{ g2.path }}">{{ g2.name }}</a>
					</li>
				{% endfor %}
				</ul>
			{% endif %}
		{% endfor %}
		</div>
		#}

		<div class="topicsList" id="guide-nav">
		{{ groot|json|safe }}

			{% for g in groot.children %}
			<li
				{% if g.children.length %}class="has-children"{% endif %}
				data-nchildren="{{ g.children.length }}"
				data-path="{{ g.path }}"
				>
				<a {% if g.path %} href="{{ g.path }}" {% endif %}>{{ g.name }}</a>
			</li>
			<ul>
				{% for g2 in g.children %}
				<li {% if guideNode.id === g2.id %} class="active" {% endif %}>
					<a href="{{ g2.path }}">{{ g2.name }}</a>
				</li>
				{% endfor %}
			</ul>
			{% endfor %}
		</div>

		<div>
			<button onClick="window.open('https://docs.google.com/forms/d/1muCz4nyeGmoMeH1IqG22av_MjyClzHvv3OiqmnxVAFI/viewform')" class="feedback-btn" id="guide-feedback-btn">
				Sabe como melhorar esse texto?
			</button>
			{% if guideNode.linkSource %}
			<a href="{{ guideNode.linkSource }}" class="button goto-github">
				Ver no <i class="icon-github"></i> Github
			</a>
			{% endif %}
		</div>
	</div>

	<div class="contentCol">
		<div class="section content">
			{{ guideNode.html|safe }}
		</div>
		{% if guideNode.notes %}
		<div class="section notes">
			{{ guideNode.notes|safe }}
		</div>
		{% endif %}
		{% if groot.author %}
		<div class="section author">
			<a href="{{ groot.author.path }}">
				<div class="user-avatar">
					<div class="avatar" style="background-image: url('{{ groot.author.avatar_url }}')" alt="{{ groot.author.name }}"></div>
				</div>
				<div class="right">
					<div class="name">
						{{ groot.author.name }}
					</div>
					<div class="location">
						{{ groot.author.profile.location }}
					</div>
				</div>
			</a>
		</div>
		{% endif %}
	</div>
</div>

<footer>
	<i class="icon-lightbulb xbulb inverse"></i>
</footer>

<script>
var gpath = {{ gpath|json|safe }};

function toggleArrow(node) {
	if ($(node).hasClass('open')) {
		$('.topicsList').find('li.isOpen, li.hasChildren').removeClass('open');
		$(node).removeClass('open');
	} else {
		$('.topicsList').find('li.isOpen, li.hasChildren').removeClass('open');
		$(node).addClass('open');
	}
}

function arrowifySidebar(el) {
	if (!el) {
		throw new Error("Dude, a need a guide-nav to work with.");
	}

	function workChildren(chld) {
	}

	var sections = el.children;
	for (var i=0; i<sections.length; ++i) {
		var section = sections[i];
		if (section.tagName !== 'LI') {
			continue;
		}

		var hasChildren = section.dataset.nchildren !== '0';
		var isActive = gpath;
		// workChildren()
	}
}

arrowifySidebar(document.querySelector("#guide-nav"));

</script>

<script>

</script>

{% endblock %}